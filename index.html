<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on https://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" href="stylesheets/github-dark.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>google authorization</title>
  <meta name="description" content="Google authentication for Hubot and Slack.">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">google authorization</h1>
    </header>
    <div id="container">
      <p class="tagline">Google authentication for Hubot and Slack.</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/mik25/hubot-slack-google-auth/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/mik25/hubot-slack-google-auth/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/mik25/hubot-slack-google-auth" class="code">View google authorization on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h2>
<a id="hubot-slack-google-auth" class="anchor" href="#hubot-slack-google-auth" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hubot-Slack Google Auth</h2>

<p>Allows Slack users to authenticate with Google APIs using OAuth 2.0. This script is not meant to be used directly (it only has 1 command, for destroying a user's credentials), but provides an easy interface for other scripts to get an oauth2 client to be used with other <a href="https://github.com/google/google-api-nodejs-client/">Google APIs</a>.</p>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Create a new project in the <a href="https://console.developers.google.com">Google Developers Console</a> and add a new web application client ID. The redirect URI for the application should be <code>&lt;public web address of your hubot instance&gt;/google/auth/callback</code> The following environment variables must be set:</p>

<ul>
<li>
<code>HUBOT_GOOGLE_OAUTH_CLIENT_ID</code>: OAuth client ID</li>
<li>
<code>HUBOT_GOOGLE_OAUTH_CLIENT_SECRET</code>: OAuth client secret</li>
<li>
<code>HUBOT_GOOGLE_SITE_VERIFICATION</code>: When adding a push domain, Google requires you to verify you own the domain using Webmaster Tools. For convenience, you can set this env variable and the script will create the required HTML page that google checks.</li>
<li>
<code>HUBOT_URL</code>: Public URL where your hubot instance is running. Used for the OAuth redirect URI.</li>
<li>
<code>HUBOT_GOOGLE_SCOPES</code>: Comma-separated list of additional scopes (beyond the basic user info ones) needed when a user authenticates. For example, if using the calendar script you would need <code>https://www.googleapis.com/auth/calendar</code>.</li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>This script is meant to be used by other scripts that respond to user commands, and as such there is really no "log in to google" command. Rather, it works by prompting the user to log in when they issue the first command that requires authentication and storing the access token and refresh token in the hubot brain.</p>

<p>To use in a script, just emit the <code>google:authenticate</code> event with the user (or message) and a callback that takes an error and oauth client:</p>

<div class="highlight highlight-js"><pre>robot.respond(<span class="pl-sr"><span class="pl-pds">/</span>create(me )<span class="pl-k">?</span>( an)<span class="pl-k">?</span> event (<span class="pl-c1">.</span><span class="pl-k">*</span>)<span class="pl-pds">/</span>i</span>, <span class="pl-k">function</span>(<span class="pl-smi">msg</span>) {
  robot.emit(<span class="pl-s"><span class="pl-pds">'</span>google:authenticate<span class="pl-pds">'</span></span>, msg, <span class="pl-k">function</span>(<span class="pl-smi">err</span>, <span class="pl-smi">oauth</span>) {
    googleapis
    .calendar(<span class="pl-s"><span class="pl-pds">'</span>v3<span class="pl-pds">'</span></span>)
    .events.quickAdd({ auth<span class="pl-k">:</span> oauth }, <span class="pl-k">function</span>(<span class="pl-smi">err</span>, <span class="pl-smi">event</span>) {
      <span class="pl-c">// ...</span>
    });
  });
});</pre></div>

<p>The callback will be called immediately if the user is already authenticated, or after the user logs in if they aren't. It will also handle refreshing the access token if necessary.</p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/mik25" class="avatar"><img src="https://avatars0.githubusercontent.com/u/10279545?v=3&amp;s=60" width="48" height="48"></a> <a href="https://github.com/mik25">mik25</a> maintains <a href="https://github.com/mik25/hubot-slack-google-auth">google authorization</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/mik25/hubot-slack-google-auth/tarball/master" class="tar">tar</a><a href="https://github.com/mik25/hubot-slack-google-auth/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-65178389-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

</body>
</html>
